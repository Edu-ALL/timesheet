import{aL as M,v as j,r as c,C as D,c as F,b as t,w as o,aM as Y,h as P,i as $,o as v,a as m,u as e,f as p,K as J,e as h,I as y,H as k,D as g,s as V,J as R,U as q}from"./main-BamGvAjg.js";import{r as _}from"./rules-B5G8qOzK.js";import{l as H}from"./eduall-jXBsxaj5.js";import{a as K,b as W}from"./auth-v1-mask-light--N6hHkxK.js";import{V as z,f as G,d as O,a as T,b as w}from"./VTextField-1ys-liIu.js";import{V as Q}from"./VForm-C_0S8g3K.js";import{V as X,a as x}from"./VRow-CS9fcrjS.js";import"./forwardRefs-DUMsmNF6.js";import"./VImg-C3PmJxkR.js";/* empty css              */const Z={class:"auth-wrapper d-flex align-center justify-center pa-4"},ee={class:"d-flex justify-center mb-5"},ae=["src"],se=m("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! 👋🏻",-1),te=m("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),oe={class:"d-flex align-center justify-end flex-wrap my-2"},ve={__name:"login",props:{token:String,email:String},setup(A){const N=M();j(()=>N.global.name.value==="light"?K:W);const f=A,b=c(),s=c({token:"",email:"",password:"",password_confirmation:""}),l=c(!1),u=c(!1),d=c(!0),r=c(!1),U=[i=>i!==s.value.password?"Passwords do not match":!0],L=async()=>{const{valid:i}=await b.value.validate();if(i){l.value=!0;try{const a=await g.post("api/v1/auth/email/checking",{email:s.value.email});a&&(u.value=!0,a.has_password?d.value=!0:d.value=!1),l.value=!1}catch(a){V("error","You`re email is not found!","bottom-end"),console.error(a),l.value=!1}}},C=async()=>{const{valid:i}=await b.value.validate();if(i){l.value=!0;try{if(d.value){const a=await g.post("api/v1/identity/generate-token",{email:s.value.email,password:s.value.password});a&&(R.saveToken(a.granted_token),q.saveUser(a),V("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{P.go(0)},1500))}else await S();l.value=!1}catch(a){s.value.password="",V("error","You`re password is wrong.","bottom-end"),console.error(a),l.value=!1}}},S=async()=>{try{const i=f.token?"api/v1/auth/reset-password":"api/v1/auth/create-password";await g.post(i,s.value)&&(d.value=!0,await C())}catch(i){console.error(i)}},B=()=>{s.value.email=f.email,s.value.token=f.token,u.value=!0,d.value=!1},E=()=>{Y().isAuthenticated.value&&P.push("/user/dashboard")};return D(()=>{E(),f.token&&B()}),(i,a)=>{const I=$("router-link");return v(),F("div",Z,[t(z,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:o(()=>[t(G,{class:"justify-center"},{default:o(()=>[m("div",ee,[m("img",{src:e(H),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,ae)]),t(O,{class:"font-weight-semibold text-2xl text-uppercase"},{default:o(()=>[p(" Timesheet App ")]),_:1})]),_:1}),t(T,{class:"pt-2 text-center"},{default:o(()=>[se,te]),_:1}),t(T,null,{default:o(()=>[t(Q,{ref_key:"formData",ref:b,onSubmit:J(C,["prevent"]),"validate-on":"input","fast-fail":""},{default:o(()=>[t(X,null,{default:o(()=>[t(x,{cols:"12"},{default:o(()=>[t(w,{modelValue:e(s).email,"onUpdate:modelValue":a[0]||(a[0]=n=>e(s).email=n),label:"Email",type:"email",disabled:e(u),rules:e(_).email},null,8,["modelValue","disabled","rules"]),e(u)?k("",!0):(v(),h(y,{key:0,block:"",type:"button",onClick:L,class:"mt-4",loading:e(l),disabled:e(l)},{default:o(()=>[p(" Check Email ")]),_:1},8,["loading","disabled"]))]),_:1}),e(u)&&e(d)?(v(),h(x,{key:0,cols:"12"},{default:o(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[1]||(a[1]=n=>e(s).password=n),label:"Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[2]||(a[2]=n=>r.value=!e(r)),rules:e(_).required},null,8,["modelValue","type","append-inner-icon","rules"]),m("div",oe,[t(I,{to:"/user/forgot",class:"ms-2 mb-1"},{default:o(()=>[p(" Forgot Password? ")]),_:1})]),t(y,{block:"",type:"submit",loading:e(l),disabled:e(l)},{default:o(()=>[p(" Login ")]),_:1},8,["loading","disabled"])]),_:1})):k("",!0),e(u)&&!e(d)?(v(),h(x,{key:1,cols:"12"},{default:o(()=>[t(w,{modelValue:e(s).password,"onUpdate:modelValue":a[3]||(a[3]=n=>e(s).password=n),label:"New Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[4]||(a[4]=n=>r.value=!e(r)),rules:e(_).password,class:"mb-6"},null,8,["modelValue","type","append-inner-icon","rules"]),t(w,{modelValue:e(s).password_confirmation,"onUpdate:modelValue":a[5]||(a[5]=n=>e(s).password_confirmation=n),label:"Confirmation Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[6]||(a[6]=n=>r.value=!e(r)),class:"mb-6",rules:U},null,8,["modelValue","type","append-inner-icon"]),t(y,{block:"",type:"submit",loading:e(l),disabled:e(l)},{default:o(()=>[p(" Create New Password ")]),_:1},8,["loading","disabled"])]),_:1})):k("",!0)]),_:1})]),_:1},512)]),_:1})]),_:1})])}}};export{ve as default};
