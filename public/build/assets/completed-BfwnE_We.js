import{o as v,c as A,a,d as J,b as t,V as C,w as s,u as o,n as re,a4 as ie,j as T,r as d,e as ue,z as g,F as K,v as k,A as D,l as ce,W as de,Z as pe,Y as $,m as fe,x as R,f as I,h as Q,X as me,t as m,a5 as ve,s as j,a1 as _e,a2 as he}from"./main-CRGqjzw-.js";import{r as Ve}from"./rules-B5G8qOzK.js";import{a as z,V as E,c as ye,b as ge}from"./VCard-Bc3Py79B.js";import{d as we}from"./debounce-CLVZELBw.js";import{V as be}from"./VDialog-BvwI100J.js";import{V as B,a as w}from"./VRow-BzPg3j71.js";import{V as P,a as xe}from"./VAutocomplete-DNO_oIon.js";import{V as ke}from"./VForm-B7rJfbed.js";import{V as ee}from"./VCheckbox-DK9ZxTiT.js";import{a as De,V as Ce}from"./VTable-BC4dX_NT.js";import{V as Te}from"./VPagination-BMvyxcIy.js";import{T as L}from"./index-Dgq_hfUZ.js";import"./VAvatar-hocph2ML.js";import"./VImg-T0kH_gqG.js";import"./VList-BdDJaDDw.js";import"./ssrBoot-C0V9aGId.js";import"./VDivider-BV6CD0GL.js";import"./VCheckboxBtn-CoG9ThHX.js";import"./VSelectionControl-BXVdasBI.js";import"./VSlideGroup-5qf8JxqU.js";import"./VTooltip-C2I2Mm4O.js";const Ye={class:"position-relative overflow-hidden"},Se={class:"d-flex justify-space-between"},Me={class:"text-secondary"},Ue={__name:"FilterSidebar",props:{active:Boolean,width:Number},emits:["close"],setup(H,{emit:r}){const V=H,O=r;return(_,u)=>(v(),A("section",Ye,[a("div",{class:re(["position-fixed filter-content",V.active?"active":""]),style:ie({width:V.width+"px"})},[a("div",Se,[a("h3",Me,[J(_.$slots,"header",{},()=>[T("Title")])]),a("div",{onClick:u[0]||(u[0]=Y=>O("close"))},[t(C,{icon:"ri-close-line",color:"#e08282",class:"cursor-pointer"})])]),t(o(E),{class:"mt-3"},{default:s(()=>[t(o(z),null,{default:s(()=>[J(_.$slots,"content",{},()=>[T("Content")])]),_:3})]),_:3})],6)]))}},Fe=a("div",{class:"d-flex justify-between align-center"},[a("div",{class:"w-100"},[a("h4",null,"Completed Cut-Off")])],-1),Ne=a("thead",null,[a("tr",null,[a("th",{class:"text-uppercase"},"#"),a("th",{class:"text-uppercase text-center"},"Timesheet"),a("th",{class:"text-uppercase text-center"},"Activity"),a("th",{class:"text-uppercase text-center"},"Students Name"),a("th",{class:"text-uppercase text-center"},"Activity Date"),a("th",{class:"text-uppercase text-center"},"Mentor/Tutor"),a("th",{class:"text-uppercase text-center"},"Time Spent"),a("th",{class:"text-uppercase text-center"},"Fee/Hours"),a("th",{class:"text-uppercase text-center"},"Total"),a("th",{class:"text-uppercase text-center"},"Cut-Off Date"),a("th",{class:"text-uppercase text-center"},"Cut-Off Status")])],-1),$e={class:"text-center"},Ie={class:"text-center"},Ae=a("th",{colspan:"9"},"Total Fee",-1),Oe={colspan:"2",class:"text-end"},Re={key:0},je=a("tr",null,[a("td",{colspan:"10",class:"text-center"}," Sorry, no data found. ")],-1),Be=[je],Pe={class:"d-flex justify-center mt-5"},ut={__name:"completed",setup(H){const r=d(!1),V=d([]),O=d(),_=d(!1),u=d({cut_off_date:[],specific:!1,timesheet_id:null}),Y=d(!1),S=d(1),q=d(),b=d([]),M=d(null),U=d(null),W=d([]),F=d(null),X=d([]),Z=d([]),h=d(null),y=async()=>{r.value=!0;const n="?page="+S.value,l=M.value?"&keyword="+M.value:"",c=U.value?"&package_id="+U.value:"",e=h.value?"&cutoff_start="+k(h.value[0]).format("YYYY-MM-DD"):"",p=h.value?"&cutoff_end="+k(h.value[h.value.length-1]).format("YYYY-MM-DD"):"",i=F.value?"&mentor_id="+F.value:"",x="api/v1/payment/paid"+n+l+c+e+p+i;try{const f=await D.get(x);f&&(S.value=f.current_page,q.value=f.last_page,V.value=f)}catch(f){console.error(f)}finally{r.value=!1}},te=we(async()=>{await y()},500),ae=async()=>{r.value=!0;try{const n=await D.get("api/v1/package/component/list");n&&(W.value=n,r.value=!1)}catch(n){r.value=!1,console.error(n)}},le=async()=>{r.value=!0;try{const n=await D.get("api/v1/user/mentor-tutors");n&&(X.value=n,r.value=!1)}catch(n){r.value=!1,console.error(n)}},oe=async()=>{const n=await ve("Are you sure you want to cancel this activity?"),l={activity_id:Object.keys(b.value).map(c=>b.value[c])};if(n){r.value=!0;try{const c=await D.patch("api/v1/payment/cut-off/unassign",l);c&&(j("success",c.message,"bottom-end"),y())}catch(c){j("error",c.response.statusText,"bottom-end")}finally{r.value=!1}}},se=async()=>{let n=u.value.cut_off_date,l=k(n[0]).format("YYYY-MM-DD"),c=k(n[n.length-1]).format("YYYY-MM-DD");const e="api/v1/timesheet/component/list?cutoff_start="+l+"&cutoff_end="+c;r.value=!0;try{const p=await D.get(e);p&&(Z.value=p,r.value=!1)}catch(p){r.value=!1,console.error(p)}},ne=async()=>{var x;let n=u.value.cut_off_date,l=k(n[0]).format("YYYY-MM-DD"),c=k(n[n.length-1]).format("YYYY-MM-DD"),p="api/v1/payment/cut-off/export"+(u.value.specific?"/"+u.value.timesheet_id:"")+"/"+l+"/"+c;const{valid:i}=await O.value.validate();if(i){_.value=!1,_e();try{const f=await D.get(p,{responseType:"blob"});if(f){const G=window.URL.createObjectURL(new Blob([f],{type:'"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"'})),N=document.createElement("a");N.href=G,N.setAttribute("download",`payroll_${l}_${c}.xlsx`),document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(G),he.close(),u.value.specific=!1,u.value.timesheet_id=null}}catch(f){j("error",(x=f.response)==null?void 0:x.statusText,"bottom-end"),console.log(f)}}};return ue(()=>{y(),ae(),le()}),(n,l)=>{const c=ce("VDateInput");return v(),A(K,null,[t(Ue,{active:o(Y),width:450,onClose:l[4]||(l[4]=e=>Y.value=!1)},{header:s(()=>[T(" Filter ")]),content:s(()=>[t(B,{class:"my-1"},{default:s(()=>[t(w,{cols:"12"},{default:s(()=>[t(de,{modelValue:o(M),"onUpdate:modelValue":l[0]||(l[0]=e=>g(M)?M.value=e:null),placeholder:"Search","prepend-inner-icon":"ri-search-line",variant:"solo",onInput:o(te)},null,8,["modelValue","onInput"])]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(P,{clearable:"true",loading:o(r),disabled:o(r),label:"Package Name",items:o(W),"item-title":e=>e.package?e.type_of+" - "+e.package:e.type_of,"item-value":"id",modelValue:o(U),"onUpdate:modelValue":[l[1]||(l[1]=e=>g(U)?U.value=e:null),y],placeholder:"Select Timesheet Package",variant:"solo"},null,8,["loading","disabled","items","item-title","modelValue"])]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(P,{loading:o(r),disabled:o(r),clearable:"true",label:"Tutor/Mentor Name",items:o(X),"item-props":e=>({title:e.full_name,subtitle:e.roles.map(p=>p.name).join(", ")}),"item-value":"id",modelValue:o(F),"onUpdate:modelValue":[l[2]||(l[2]=e=>g(F)?F.value=e:null),y],placeholder:"Select Tutor/Mentor Name",variant:"solo"},null,8,["loading","disabled","items","item-props","modelValue"])]),_:1}),t(w,{cols:"12"},{default:s(()=>[t(c,{modelValue:o(h),"onUpdate:modelValue":[l[3]||(l[3]=e=>g(h)?h.value=e:null),y],label:"Cut-Off Date","prepend-icon":"",multiple:"range",color:"primary",variant:"solo"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["active"]),t(be,{modelValue:o(_),"onUpdate:modelValue":l[9]||(l[9]=e=>g(_)?_.value=e:null),width:"auto"},{default:s(()=>[t(E,{width:"450","prepend-icon":"ri-download-line",title:"Download Timesheet"},{default:s(()=>[t(z,null,{default:s(()=>[t(ke,{onSubmit:pe(ne,["prevent"]),ref_key:"formData",ref:O},{default:s(()=>[t(B,null,{default:s(()=>[t(w,{cols:"12"},{default:s(()=>[t(c,{label:"Start - End Date",variant:"solo","prepend-icon":"",multiple:"range",modelValue:o(u).cut_off_date,"onUpdate:modelValue":[l[5]||(l[5]=e=>o(u).cut_off_date=e),se],rules:o(Ve).required,class:"mb-3"},null,8,["modelValue","rules"]),t(ee,{label:"Specific Timesheet",modelValue:o(u).specific,"onUpdate:modelValue":l[6]||(l[6]=e=>o(u).specific=e)},null,8,["modelValue"]),t(P,{loading:o(r),label:"Timesheet - Package",variant:"solo",items:o(Z),"item-props":e=>({title:e.package_type+" - "+e.package_name,subtitle:e.clients}),"item-value":"id",class:"mt-3",modelValue:o(u).timesheet_id,"onUpdate:modelValue":l[7]||(l[7]=e=>o(u).timesheet_id=e),disabled:!o(u).specific},null,8,["loading","items","item-props","modelValue","disabled"])]),_:1})]),_:1}),t(ye,{class:"mt-5"},{default:s(()=>[t($,{color:"error",onClick:l[8]||(l[8]=e=>_.value=!1)},{default:s(()=>[t(C,{icon:"ri-close-line",class:"me-3"}),T(" Close ")]),_:1}),t(fe),t($,{color:"success",type:"submit"},{default:s(()=>[T(" Download "),t(C,{icon:"ri-download-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(E,null,{default:s(()=>[t(ge,null,{default:s(()=>[Fe]),_:1}),t(z,null,{default:s(()=>[t(B,{class:"my-1"},{default:s(()=>[t(w,{cols:"6"},{default:s(()=>[R((v(),I($,{color:"info",onClick:l[10]||(l[10]=e=>Y.value=!o(Y))},{default:s(()=>[t(C,{icon:"ri-search-line"})]),_:1})),[[L,"Filter","end"]])]),_:1}),t(w,{cols:"6",class:"text-end"},{default:s(()=>[o(b).length>0?R((v(),I($,{key:0,color:"error",class:"me-1",onClick:oe},{default:s(()=>[t(C,{icon:"ri-close-line"})]),_:1})),[[L,"Cancel","start"]]):Q("",!0),R((v(),I($,{color:"secondary",onClick:l[11]||(l[11]=e=>_.value=!0)},{default:s(()=>[t(C,{icon:"ri-download-line"})]),_:1})),[[L,"Download Timesheet","start"]])]),_:1})]),_:1}),o(r)?(v(),I(Ce,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(v(),I(De,{key:1,class:"text-no-wrap"},{default:s(()=>{var e,p;return[Ne,a("tbody",null,[(v(!0),A(K,null,me(o(V).data,i=>(v(),A("tr",{key:i},[a("td",null,[t(ee,{modelValue:o(b),"onUpdate:modelValue":l[12]||(l[12]=x=>g(b)?b.value=x:null),value:i.id},null,8,["modelValue","value"])]),a("td",null,m(i.package.type+" - "+i.package.name),1),a("td",null,m(i.students),1),a("td",null,m(i.activity),1),a("td",null,m(i.date),1),a("td",null,m(i.mentor_tutor),1),a("td",null,m(i.time_spent>0?(i.time_spent/60).toFixed(2)+" Hours":"-"),1),a("td",null,"Rp. "+m(new Intl.NumberFormat("id-ID").format(i.fee_hours)),1),a("td",null,"Rp. "+m(new Intl.NumberFormat("id-ID").format(i.time_spent/60*i.fee_hours)),1),a("td",$e,m(i.cutoff_date),1),a("td",Ie,[t(xe,{color:"success"},{default:s(()=>[T(m(i.cutoff_status),1)]),_:2},1024)])]))),128))]),a("thead",null,[a("tr",null,[Ae,a("th",Oe," Rp. "+m(new Intl.NumberFormat("id-ID").format(o(V).total_fee)),1)])]),((p=(e=o(V))==null?void 0:e.data)==null?void 0:p.length)==0?(v(),A("tfoot",Re,Be)):Q("",!0)]}),_:1})),a("div",Pe,[t(Te,{modelValue:o(S),"onUpdate:modelValue":[l[13]||(l[13]=e=>g(S)?S.value=e:null),y],length:o(q),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})],64)}}};export{ut as default};
