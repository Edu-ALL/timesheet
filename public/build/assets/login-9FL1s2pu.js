import{a6 as M,K as Y,r as m,e as F,c as $,b as s,w as l,a7 as J,k as C,l as R,o as b,a as f,u as e,j as p,f as h,W as c,Y as V,Z as P,h as W,A as _,s as g,J as q,U as K}from"./main-CRGqjzw-.js";import{r as y}from"./rules-B5G8qOzK.js";import{l as Z}from"./eduall-jXBsxaj5.js";import{a as z,b as G}from"./auth-v1-mask-light--N6hHkxK.js";import{V as H,d as O,b as Q,a as T}from"./VCard-Bc3Py79B.js";import{V as A,a as k}from"./VRow-BzPg3j71.js";import{V as U}from"./VForm-B7rJfbed.js";import"./VAvatar-hocph2ML.js";import"./VImg-T0kH_gqG.js";const X={class:"auth-wrapper d-flex align-center justify-center pa-4"},ee={class:"d-flex justify-center mb-5"},ae=["src"],se=f("h5",{class:"text-h5 font-weight-semibold mb-1"},"Welcome to Timesheet App! 👋🏻",-1),te=f("p",{class:"mb-0"},"Please sign-in to your account and start the adventure",-1),le={class:"d-flex align-center justify-end flex-wrap my-2"},fe={__name:"login",props:{token:String,email:String},setup(N){const S=M();Y(()=>S.global.name.value==="light"?z:G);const v=N,w=m(),t=m({token:"",email:"",password:"",password_confirmation:""}),o=m(!1),d=m(!1),u=m(!0),r=m(!1),E=[n=>n!==t.value.password?"Passwords do not match":!0],j=async()=>{const{valid:n}=await w.value.validate();if(n){o.value=!0;try{const a=await _.post("api/v1/auth/email/checking",{email:t.value.email});a&&(d.value=!0,a.has_password?u.value=!0:u.value=!1),o.value=!1}catch(a){g("error","You`re email is not found!","bottom-end"),console.error(a),o.value=!1}}},x=async()=>{const{valid:n}=await w.value.validate();if(n){o.value=!0;try{if(u.value){const a=await _.post("api/v1/identity/generate-token",{email:t.value.email,password:t.value.password});a&&(q.saveToken(a.granted_token),K.saveUser(a),g("success","You`ve successfully login.","bottom-end"),setTimeout(()=>{C.go(0)},1500))}else await B();o.value=!1}catch(a){t.value.password="",g("error","You`re password is wrong.","bottom-end"),console.error(a),o.value=!1}}},B=async()=>{try{const n=v.token?"api/v1/auth/reset-password":"api/v1/auth/create-password";await _.post(n,t.value)&&(u.value=!0,await x())}catch(n){console.error(n)}},L=()=>{t.value.email=v.email,t.value.token=v.token,d.value=!0,u.value=!1},D=()=>{J().isAuthenticated.value&&C.push("/user/dashboard")};return F(()=>{D(),v.token&&L()}),(n,a)=>{const I=R("router-link");return b(),$("div",X,[s(H,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:l(()=>[s(O,{class:"justify-center"},{default:l(()=>[f("div",ee,[f("img",{src:e(Z),alt:"Timesheet - EduALL",class:"w-50 text-center"},null,8,ae)]),s(Q,{class:"font-weight-semibold text-2xl text-uppercase"},{default:l(()=>[p(" Timesheet App ")]),_:1})]),_:1}),s(T,{class:"pt-2 text-center"},{default:l(()=>[se,te]),_:1}),s(T,null,{default:l(()=>[e(d)?(b(),h(U,{key:1,ref_key:"formData",ref:w,onSubmit:P(x,["prevent"]),"validate-on":"input","fast-fail":""},{default:l(()=>[s(A,null,{default:l(()=>[s(k,{cols:"12"},{default:l(()=>[s(c,{modelValue:e(t).email,"onUpdate:modelValue":a[1]||(a[1]=i=>e(t).email=i),label:"Email",type:"email",disabled:e(d),rules:e(y).email},null,8,["modelValue","disabled","rules"])]),_:1}),s(k,{cols:"12"},{default:l(()=>[s(c,{modelValue:e(t).password,"onUpdate:modelValue":a[2]||(a[2]=i=>e(t).password=i),label:"Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[3]||(a[3]=i=>r.value=!e(r)),rules:e(y).required},null,8,["modelValue","type","append-inner-icon","rules"]),f("div",le,[s(I,{to:"/user/forgot",class:"ms-2 mb-1"},{default:l(()=>[p(" Forgot Password? ")]),_:1})]),s(V,{block:"",type:"submit",loading:e(o),disabled:e(o)},{default:l(()=>[p(" Login ")]),_:1},8,["loading","disabled"])]),_:1}),e(d)&&!e(u)?(b(),h(k,{key:0,cols:"12"},{default:l(()=>[s(c,{modelValue:e(t).password,"onUpdate:modelValue":a[4]||(a[4]=i=>e(t).password=i),label:"New Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[5]||(a[5]=i=>r.value=!e(r)),rules:e(y).password,class:"mb-6"},null,8,["modelValue","type","append-inner-icon","rules"]),s(c,{modelValue:e(t).password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=i=>e(t).password_confirmation=i),label:"Confirmation Password",placeholder:"············",type:e(r)?"text":"password","append-inner-icon":e(r)?"ri-eye-off-line":"ri-eye-line","onClick:appendInner":a[7]||(a[7]=i=>r.value=!e(r)),class:"mb-6",rules:E},null,8,["modelValue","type","append-inner-icon"]),s(V,{block:"",type:"submit",loading:e(o),disabled:e(o)},{default:l(()=>[p(" Create New Password ")]),_:1},8,["loading","disabled"])]),_:1})):W("",!0)]),_:1})]),_:1},512)):(b(),h(U,{key:0,ref_key:"formData",ref:w,onSubmit:P(j,["prevent"])},{default:l(()=>[s(A,null,{default:l(()=>[s(k,{cols:"12"},{default:l(()=>[s(c,{modelValue:e(t).email,"onUpdate:modelValue":a[0]||(a[0]=i=>e(t).email=i),label:"Email",type:"email",disabled:e(d),rules:e(y).email},null,8,["modelValue","disabled","rules"]),s(V,{block:"",type:"submit",class:"mt-4",loading:e(o),disabled:e(o)},{default:l(()=>[p(" Check Email ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512))]),_:1})]),_:1})])}}};export{fe as default};
