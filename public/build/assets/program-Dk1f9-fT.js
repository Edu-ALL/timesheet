import{r as n,C as O,o as f,e as y,w as s,b as t,K as W,u as e,E as D,H as R,I as E,V as w,f as C,D as S,s as G,i as X,t as q,a as d,c as F,G as Z,F as ee,n as te}from"./main-BamGvAjg.js";import{r as U}from"./rules-B5G8qOzK.js";import{a as z,b as K,e as le,V as Y,d as ae}from"./VTextField-1ys-liIu.js";import{V as oe}from"./VForm-C_0S8g3K.js";import{V as J,a as _}from"./VRow-CS9fcrjS.js";import{V as I}from"./VAutocomplete-CV-sKyN8.js";import{V as se}from"./VTextarea-CVFe_fYC.js";import{V as re}from"./VDivider-BVdfafVF.js";import{V as ne}from"./VSpacer-5-XwI9bQ.js";import{V as ie}from"./VDialog-CfWozT0b.js";import{V as de}from"./VSkeletonLoader-HKZIy6ej.js";import{V as ue}from"./VTable-SAWoljyi.js";import{V as ce}from"./VPagination-Csy0LPkf.js";import{V as me}from"./VCheckbox-D0p3f3Zp.js";import{V as L}from"./VTooltip-D20pEGI9.js";import"./forwardRefs-DUMsmNF6.js";import"./VImg-C3PmJxkR.js";/* empty css              */import"./VList-DyE5X8Dw.js";import"./VOverlay-BSOkjb50.js";import"./lazy-D8v9bkkP.js";import"./dialog-transition-C_q3zPbm.js";import"./ssrBoot-DWWf1isl.js";import"./VCheckboxBtn-CJx0AXnU.js";import"./VSelectionControl-Cb_evK1R.js";const pe={__name:"program_add",emits:["close","reload"],setup(Q,{emit:v}){const j=v,i=n(!1),V=n([]),k=n([]),T=n([]),m=n([]),M=n([]),h=n([]),x=n(!1),$=n(),r=n({ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]}),g=async(o=!1)=>{const a=o?"api/v1/user/mentor-tutors?inhouse=true":"api/v1/user/mentor-tutors";try{const l=await S.get(a);l&&(o?h.value=Object.values(l):k.value=l)}catch(l){console.error(l)}},u=async()=>{try{const o=await S.get("api/v1/package/component/list");o&&(m.value=o)}catch(o){console.error(o)}},N=()=>{const o=r.value.package_id,a=m.value.findIndex(b=>b.id===o);let l=m.value[a];l.detail?(x.value=!0,r.value.duration=l.detail):(x.value=!1,r.value.duration=null)},c=async()=>{try{const o=await S.get("api/v1/user/component/list");o&&(M.value=o)}catch(o){console.error(o)}},P=async o=>{r.value.subject_id=null;try{const a=await S.get("api/v1/user/mentor-tutors/"+o+"/subjects");a&&(T.value=a)}catch(a){console.error(a)}},p=async()=>{var a,l;i.value=!0,r.value.mentortutor_email=V.value.email;const{valid:o}=await $.value.validate();if(o){r.value.ref_id=selected.value;try{const b=await S.post("api/v1/timesheet/create",r.value);b&&(G("success",b.message,"bottom-end"),selected.value=[],dialog.value=!1,r.value={ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]},V.value=[],getData())}catch(b){if((l=(a=b==null?void 0:b.response)==null?void 0:a.data)!=null&&l.errors){const A=b.response.data.errors;let H="Validation errors:";for(const B in A)A.hasOwnProperty(B)&&(H+=`
${B}: ${A[B].join(", ")}`);G("error",H,"bottom-end")}}finally{i.value=!1}}};return O(()=>{g(),g(!0),u(),c()}),(o,a)=>(f(),y(Y,{width:"600","prepend-icon":"ri-send-plane-line",title:"Assign to Mentor/Tutor"},{default:s(()=>[t(z,null,{default:s(()=>[t(oe,{onSubmit:W(p,["prevent"]),ref_key:"formData",ref:$,"validate-on":"input"},{default:s(()=>[t(J,null,{default:s(()=>[t(_,{md:"12"},{default:s(()=>[t(I,{density:"compact",clearable:"",modelValue:e(V),"onUpdate:modelValue":[a[0]||(a[0]=l=>D(V)?V.value=l:null),a[1]||(a[1]=l=>P(e(V).uuid))],label:"Mentor/Tutor",items:e(k),"item-props":l=>({title:l.first_name+" "+l.last_name}),rules:e(U).required,loading:e(i),disabled:e(i)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),e(T).length>0?(f(),y(_,{key:0,md:"12"},{default:s(()=>[t(I,{density:"compact",clearable:"",modelValue:e(r).subject_id,"onUpdate:modelValue":a[2]||(a[2]=l=>e(r).subject_id=l),label:"Subject Tutoring",items:e(T),"item-title":"subject","item-value":"id",loading:e(i),disabled:e(i),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1})):R("",!0),t(_,{md:"8"},{default:s(()=>[t(I,{density:"compact",clearable:"",label:"Package",modelValue:e(r).package_id,"onUpdate:modelValue":[a[3]||(a[3]=l=>e(r).package_id=l),N],items:e(m),"item-props":l=>({title:l.package!=null?l.type_of+" - "+l.package:l.type_of}),"item-value":"id",rules:e(U).required,loading:e(i),disabled:e(i)},null,8,["modelValue","items","item-props","rules","loading","disabled"])]),_:1}),t(_,{md:"4"},{default:s(()=>[t(K,{type:"number",density:"compact",clearable:"",label:+e(r).duration/60?"Minutes ("+e(r).duration/60+" Hours)":"Minutes",readonly:e(x),modelValue:e(r).duration,"onUpdate:modelValue":a[4]||(a[4]=l=>e(r).duration=l),rules:e(U).required},null,8,["label","readonly","modelValue","rules"])]),_:1}),t(_,{md:"12"},{default:s(()=>[t(I,{density:"compact",clearable:"",modelValue:e(r).inhouse_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e(r).inhouse_id=l),label:"Inhouse Mentor/Tutor",items:e(h),"item-props":l=>({title:l.first_name+" "+l.last_name}),"item-value":"uuid",loading:e(i),disabled:e(i),rules:e(U).required},null,8,["modelValue","items","item-props","loading","disabled","rules"])]),_:1}),t(_,{md:"12"},{default:s(()=>[t(I,{density:"compact",multiple:"",clearable:"",chips:"",label:"PIC",modelValue:e(r).pic_id,"onUpdate:modelValue":a[6]||(a[6]=l=>e(r).pic_id=l),items:e(M),"item-title":"full_name","item-value":"id",loading:e(i),disabled:e(i),rules:e(U).required},null,8,["modelValue","items","loading","disabled","rules"])]),_:1}),t(_,{md:"12"},{default:s(()=>[t(se,{label:"Notes",modelValue:e(r).notes,"onUpdate:modelValue":a[7]||(a[7]=l=>e(r).notes=l)},null,8,["modelValue"])]),_:1})]),_:1}),t(re,{class:"my-3"}),t(le,null,{default:s(()=>[t(E,{color:"error",type:"button",onClick:a[8]||(a[8]=l=>j("close"))},{default:s(()=>[t(w,{icon:"ri-close-line",class:"me-3"}),C(" Close ")]),_:1}),t(ne),t(E,{color:"success",type:"submit"},{default:s(()=>[C(" Save "),t(w,{icon:"ri-save-line",class:"ms-3"})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},fe=d("div",{class:"d-flex justify-between align-center"},[d("div",{class:"w-100"},[d("h4",null,"Program Name")])],-1),ge=d("thead",null,[d("tr",null,[d("th",{class:"text-uppercase",width:"1%"}," # "),d("th",{class:"text-uppercase text-center"},"Invoice ID"),d("th",{class:"text-uppercase text-center"},"Student/School Name"),d("th",{class:"text-uppercase text-center"},"Program Name"),d("th",{class:"text-uppercase text-center"},"Timesheet")])],-1),_e={nowrap:""},ve={class:"text-left",nowrap:""},Ve={class:"text-left",nowrap:""},be={class:"text-center"},ye={key:0},ke=d("tr",null,[d("td",{colspan:"6",class:"text-center"}," Sorry, no data found. ")],-1),he=[ke],xe={class:"d-flex justify-center mt-5"},Je={__name:"program",setup(Q){const v=n([]),j=n(!1),i=n(1),V=n(),k=n(),T=n([]),m=n(!1),M=n([]),h=n();n(),n({ref_id:[],mentortutor_email:null,subject_id:null,inhouse_id:null,package_id:null,duration:"",notes:"",pic_id:[]});const x=async()=>{var P,p;const g="?page="+i.value,u=k.value?"&keyword="+k.value:"",N=h.value?"&program_name="+h.value:"",c="&paginate=true";try{m.value=!0;const o=await S.get("api/v1/program/list"+g+u+N+c);o&&(i.value=o.current_page,V.value=o.last_page,T.value=o),m.value=!1}catch(o){G("error",(p=(P=o.response)==null?void 0:P.data)==null?void 0:p.message,"bottom-end"),console.error(o),m.value=!1}},$=async()=>{try{const g=await S.get("api/v1/program/component/list");g&&(M.value=g)}catch(g){console.error(g)}},r=async()=>{i.value=1,await x()};return O(()=>{x(),$()}),(g,u)=>{const N=X("VText");return f(),y(Y,null,{default:s(()=>[t(ae,null,{default:s(()=>[fe]),_:1}),t(z,null,{default:s(()=>[t(J,{class:"my-1"},{default:s(()=>[t(_,{cols:"12",md:"5"},{default:s(()=>[t(I,{clearable:"",modelValue:e(h),"onUpdate:modelValue":[u[0]||(u[0]=c=>D(h)?h.value=c:null),x],label:"Program Name",items:e(M),"item-title":"program_name",placeholder:"Select Program Name",density:"compact",variant:"solo","hide-details":"","single-line":"",loading:e(m),disabled:e(m)},null,8,["modelValue","items","loading","disabled"])]),_:1}),t(_,{cols:"12",md:"3"},{default:s(()=>[t(K,{loading:e(m),disabled:e(m),"append-inner-icon":"ri-search-line",density:"compact",label:"Search",variant:"solo","hide-details":"","single-line":"",modelValue:e(k),"onUpdate:modelValue":u[1]||(u[1]=c=>D(k)?k.value=c:null),onChange:r},null,8,["loading","disabled","modelValue"])]),_:1}),t(_,{cols:"12",md:"4",class:"text-end"},{default:s(()=>[t(E,{density:"compact",color:e(v).length>0?"warning":"primary",class:"mb-2",disabled:!(e(v).length>0),onClick:u[2]||(u[2]=c=>j.value=!0)},{default:s(()=>[C(" Assign "+q(e(v).length>1?"to Group":""),1)]),_:1},8,["color","disabled"])]),_:1})]),_:1}),t(ie,{modelValue:e(j),"onUpdate:modelValue":u[4]||(u[4]=c=>D(j)?j.value=c:null),width:"auto",persistent:""},{default:s(()=>[t(pe,{onClose:u[3]||(u[3]=c=>j.value=!1)})]),_:1},8,["modelValue"]),e(m)?(f(),y(de,{key:0,class:"mx-auto border",type:"table-thead, table-row@10"})):(f(),y(ue,{key:1,class:"table-responsive"},{default:s(()=>{var c,P;return[ge,d("tbody",null,[(f(!0),F(ee,null,Z(e(T).data,(p,o)=>(f(),F("tr",{key:o,class:te({"bg-secondary":e(v).includes(p.id)})},[d("td",null,[p.timesheet_id?(f(),y(w,{key:1,icon:"ri-check-line",color:"success"})):(f(),y(me,{key:0,modelValue:e(v),"onUpdate:modelValue":u[5]||(u[5]=a=>D(v)?v.value=a:null),value:p.id},null,8,["modelValue","value"]))]),d("td",_e,[t(w,{icon:"ri-receipt-line",class:"me-3"}),C(" "+q(p.invoice_id),1)]),d("td",ve,[t(w,{icon:"ri-user-line",class:"me-3"}),C(" "+q(p.student_name+" - "+p.student_school),1)]),d("td",Ve,[t(w,{icon:"ri-bookmark-line",class:"me-3"}),C(" "+q(p.program_name),1)]),d("td",be,[p.timesheet_id?(f(),y(N,{key:0},{default:s(()=>[t(w,{icon:"ri-file-check-line",class:"mx-1",color:"success"}),t(L,{activator:"parent",location:"top"},{default:s(()=>[C("Already")]),_:1})]),_:1})):(f(),y(N,{key:1},{default:s(()=>[t(w,{icon:"ri-file-close-line",class:"mx-1",color:"error"}),t(L,{activator:"parent",location:"top"},{default:s(()=>[C("Not Yet")]),_:1})]),_:1}))])],2))),128))]),((P=(c=e(T))==null?void 0:c.data)==null?void 0:P.length)==0?(f(),F("tfoot",ye,he)):R("",!0)]}),_:1})),d("div",xe,[t(ce,{modelValue:e(i),"onUpdate:modelValue":[u[6]||(u[6]=c=>D(i)?i.value=c:null),x],length:e(V),"total-visible":4,color:"primary",density:"compact","show-first-last-page":!1},null,8,["modelValue","length"])])]),_:1})]),_:1})}}};export{Je as default};
